"use strict";XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(e){for(var n=e.length,t=new Uint8Array(n),o=0;o<n;o++)t[o]=255&e.charCodeAt(o);this.send(t)});var AJAXSubmit=function(){function e(){console.log(this.responseText),runRefresh()}function n(n){n.status>0||function(n){var t=new XMLHttpRequest;if(t.submittedData=n,t.onload=e,0===n.technique)t.open("get",n.receiver.replace(/(?:\?.*)?$/,n.segments.length>0?"?"+n.segments.join("&"):""),!0),t.send(null);else if(t.open("post",n.receiver,!0),3===n.technique){var o="---------------------------"+Date.now().toString(16);t.setRequestHeader("Content-Type","multipart/form-data; boundary="+o),t.sendAsBinary("--"+o+"\r\n"+n.segments.join("--"+o+"\r\n")+"--"+o+"--\r\n")}else t.setRequestHeader("Content-Type",n.contentType),t.send(n.segments.join(2===n.technique?"\r\n":"&"))}(n)}function t(e){this.owner.segments[this.segmentIdx]+=e.target.result+"\r\n",this.owner.status--,n(this.owner)}function o(e){return e.replace(/[\s\=\\]/g,"\\$&")}function s(e){var s,l,r,i,a,u="post"===e.method.toLowerCase();this.contentType=u&&e.enctype?e.enctype:"application/x-www-form-urlencoded",this.technique=u?"multipart/form-data"===this.contentType?3:"text/plain"===this.contentType?2:1:0,this.receiver=e.action,this.status=0,this.segments=[];for(var d=2===this.technique?o:escape,c=0;c<e.elements.length;c++)if((r=e.elements[c]).hasAttribute("name"))if("FILE"===(l="INPUT"===r.nodeName.toUpperCase()?r.getAttribute("type").toUpperCase():"TEXT")&&r.files.length>0)if(3===this.technique)for(s=0;s<r.files.length;s++)a=r.files[s],(i=new FileReader).segmentIdx=this.segments.length,i.owner=this,i.onload=t,this.segments.push('Content-Disposition: form-data; name="'+r.name+'"; filename="'+a.name+'"\r\nContent-Type: '+a.type+"\r\n\r\n"),this.status++,i.readAsBinaryString(a);else for(s=0;s<r.files.length;this.segments.push(d(r.name)+"="+d(r.files[s++].name)));else("RADIO"!==l&&"CHECKBOX"!==l||r.checked)&&this.segments.push(3===this.technique?'Content-Disposition: form-data; name="'+r.name+'"\r\n\r\n'+r.value+"\r\n":d(r.name)+"="+d(r.value));n(this)}return function(e){e.action&&new s(e)}}();function ready(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}function post_ajax(e,n){var t=new XMLHttpRequest;t.open("POST",e,!0),t.onload=function(){if(this.status>=200&&this.status<400){return JSON.parse(this.response)}return!1},t.send(n)}function getCookie(e){var n=document.cookie.match("(^|;) ?"+encodeURIComponent(e)+"=([^;]*)(;|$)");return n?decodeURIComponent(n[2]):null}function deleteCookie(e){setCookie(encodeURIComponent(e),"",-1)}function runRefresh(){document.body.style.cursor="progress",loggedin()&&(fillFileTable(),unblockLogin()),document.body.style.cursor="default"}function runAfterJSReady(){handleRenameLinks()}function handleUploadForm(e=".upload"){const n=document.querySelector(e);n&&null!=n&&null!=n?n.addEventListener("submit",e=>{e.preventDefault(),document.body.style.cursor="progress",console.debug("AJAX Form sent"),loggedin()?AJAXSubmit(n):console.warn("please, login to upload files")}):console.debug("Cannot find form: "+e)}function fillFileTable(e=".files tbody",n=1,t=0){if(!loggedin())return void console.warn("please, login to see your files");const o=document.querySelector(e);if(null==o||null==o)return void console.debug("Cannot find table: "+e);o.innerHTML="";let s=new FormData;s.append("files_list","true");var l=new XMLHttpRequest;l.open("POST","php/download.php",!0),l.onload=function(){if(!(this.status>=200&&this.status<400))return!1;{let e=JSON.parse(this.response);if(!e||null==e||null==e||0==e.length)return console.debug("Cannot send request: "),void console.debug(s);if(e[0].error_text&&0<e[0].error_text.length&&console.debug("Error: "+e[0].error_text),e[0].status&&0==e[0].status)return void console.debug("Cannot show files");e.forEach(e=>{let n=o.insertRow(0);n.className="table__tr";let t=n.insertCell(0),s=n.insertCell(1);t.className="table__td",s.className="table__td","folder"==e.type?t.innerHTML='<a href="#folder'+e.id+'" class="link link_folder">'+e.real_name+"</a>":t.innerHTML='<a href="php/download.php?download_file__id='+e.id+'" class="link link_download">'+e.real_name+"</a>",s.innerHTML='<a href="php/remove.php?remove_file__id='+e.id+'" class="link link_remove" title="Remove '+e.real_name+'">Remove</a>',runAfterJSReady()})}},loggedin()?l.send(s):console.warn("please, login to see your files")}function handleRenameLinks(e=".link_rename"){const n=document.querySelectorAll(e);n&&null!=n&&null!=n&&0!=n.length?n.forEach((function(e){e.addEventListener("click",(function(n){n.stopPropagation(),n.preventDefault(),console.debug(n);let t=prompt("Rename File",e.dataset.file__name);console.log(t)}),!0)})):console.debug("Cannot find links: "+e)}function handleAddFolder(e=".button_add-folder"){const n=document.querySelector(e);n&&null!=n&&null!=n?n.addEventListener("click",(function(e){let n=prompt("New Folder Name","New Folder");if(document.body.style.cursor="progress",!n||null==n||null==n||0==n.length)return console.debug("Empty new name"),void(document.body.style.cursor="default");let t=new FormData;t.append("add_folder","true"),t.append("add_folder__name",n);var o=new XMLHttpRequest;o.open("POST","php/upload.php",!0),o.onload=function(){if(!(this.status>=200&&this.status<400))return console.debug("We reached our target server, but it returned an error"),!1;{let e=JSON.parse(this.response);if(!e||null==e||null==e||0==e.length)return console.debug("Cannot get answer from server with data:"),void console.debug(t);console.debug(e),runRefresh()}},o.send(t)})):console.debug("Cannot find button: "+e)}function loggedin(){let e=getCookie("user__loggedin");return!(!e||null==e||null==e||1!=e)}function loginHandler(e="#login"){const n=document.querySelector(e);null!=n&&null!=n?n.addEventListener("submit",e=>{e.preventDefault(),document.body.style.cursor="progress",console.debug("Login Form sent via AJAX"),AJAXSubmit(n)}):console.debug("Cannot find Login form: "+e)}function unblockLogin(){let e=document.querySelectorAll(".block_hidden"),n=document.querySelectorAll(".block_visible");(e||null!=e||null!=e)&&e.forEach(e=>{e.classList.remove("block_hidden"),e.classList.add("block_visible")}),(n||null!=n||null!=n)&&n.forEach(e=>{e.classList.remove("block_visible"),e.classList.add("block_hidden")})}ready((function(){loginHandler(),fillFileTable(),handleUploadForm(),loggedin()&&unblockLogin()}));
//# sourceMappingURL=script.js.map