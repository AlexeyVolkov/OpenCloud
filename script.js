"use strict";XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(e){for(var n=e.length,t=new Uint8Array(n),o=0;o<n;o++)t[o]=255&e.charCodeAt(o);this.send(t)});var AJAXSubmit=function(){function e(){console.log(this.responseText),runRefresh()}function n(n){n.status>0||function(n){var t=new XMLHttpRequest;if(t.submittedData=n,t.onload=e,0===n.technique)t.open("get",n.receiver.replace(/(?:\?.*)?$/,n.segments.length>0?"?"+n.segments.join("&"):""),!0),t.send(null);else if(t.open("post",n.receiver,!0),3===n.technique){var o="---------------------------"+Date.now().toString(16);t.setRequestHeader("Content-Type","multipart/form-data; boundary="+o),t.sendAsBinary("--"+o+"\r\n"+n.segments.join("--"+o+"\r\n")+"--"+o+"--\r\n")}else t.setRequestHeader("Content-Type",n.contentType),t.send(n.segments.join(2===n.technique?"\r\n":"&"))}(n)}function t(e){this.owner.segments[this.segmentIdx]+=e.target.result+"\r\n",this.owner.status--,n(this.owner)}function o(e){return e.replace(/[\s\=\\]/g,"\\$&")}function r(e){var r,l,s,i,a,d="post"===e.method.toLowerCase();this.contentType=d&&e.enctype?e.enctype:"application/x-www-form-urlencoded",this.technique=d?"multipart/form-data"===this.contentType?3:"text/plain"===this.contentType?2:1:0,this.receiver=e.action,this.status=0,this.segments=[];for(var u=2===this.technique?o:escape,c=0;c<e.elements.length;c++)if((s=e.elements[c]).hasAttribute("name"))if("FILE"===(l="INPUT"===s.nodeName.toUpperCase()?s.getAttribute("type").toUpperCase():"TEXT")&&s.files.length>0)if(3===this.technique)for(r=0;r<s.files.length;r++)a=s.files[r],(i=new FileReader).segmentIdx=this.segments.length,i.owner=this,i.onload=t,this.segments.push('Content-Disposition: form-data; name="'+s.name+'"; filename="'+a.name+'"\r\nContent-Type: '+a.type+"\r\n\r\n"),this.status++,i.readAsBinaryString(a);else for(r=0;r<s.files.length;this.segments.push(u(s.name)+"="+u(s.files[r++].name)));else("RADIO"!==l&&"CHECKBOX"!==l||s.checked)&&this.segments.push(3===this.technique?'Content-Disposition: form-data; name="'+s.name+'"\r\n\r\n'+s.value+"\r\n":u(s.name)+"="+u(s.value));n(this)}return function(e){e.action&&new r(e)}}();function ready(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}function post_ajax(e,n){var t=new XMLHttpRequest;t.open("POST",e,!0),t.onload=function(){if(this.status>=200&&this.status<400){return JSON.parse(this.response)}return!1},t.send(n)}function getCookie(e){var n=document.cookie.match("(^|;) ?"+encodeURIComponent(e)+"=([^;]*)(;|$)");return n?decodeURIComponent(n[2]):null}function deleteCookie(e){setCookie(encodeURIComponent(e),"",-1)}function runRefresh(){startProgress(),loggedin()&&refreshTable(),unblockLogin(loggedin()),endProgress()}function startProgress(){document.body.style.cursor="progress"}function endProgress(){document.body.style.cursor="default"}function runAfterJSReady(){startProgress(),removeLinkConfirm(),renameLinkPrompt(),publicLinkConfirm(),folderLink(),endProgress()}function handleUploadForm(e=".upload"){const n=document.querySelector(e);n&&null!=n&&null!=n?n.addEventListener("submit",e=>{e.preventDefault(),document.body.style.cursor="progress",console.debug("AJAX Form sent"),loggedin()?AJAXSubmit(n):console.warn("please, login to upload files")}):console.debug("Cannot find form: "+e)}function refreshTable(e=".files tbody",n=1){if(!loggedin())return void console.warn("please, login to see your files");const t=document.querySelector(e);if(null==t||null==t)return void console.debug("Cannot find table: "+e);t.innerHTML="";let o=new FormData;o.append("files_list","true"),o.append("parent_folder__id",n);var r=new XMLHttpRequest;r.open("POST","php/download.php",!0),r.onload=function(){if(!(this.status>=200&&this.status<400))return!1;{let e=JSON.parse(this.response);if(!e||null==e||null==e||0==e.length)return console.debug("Cannot send request: "),void console.debug(o);if(e[0].error_text&&0<e[0].error_text.length&&console.debug("Error: "+e[0].error_text),e[0].status&&0==e[0].status)return void console.debug("Cannot show files");e.forEach(e=>{let n=t.insertRow(0);n.className="table__tr";let o=n.insertCell(0),r=n.insertCell(1),l=n.insertCell(2),s=n.insertCell(3);o.className="table__td",r.className="table__td",l.className="table__td",s.className="table__td",2==e.type?o.innerHTML='<a href="#folder'+e.id+'" class="link link_folder" data-folder__id="'+e.id+'">'+e.real_name+"</a>":1==e.type&&(o.innerHTML='<a href="php/download.php?download_file__id='+e.id+'" class="link link_download" title="Download '+e.real_name+'">'+e.real_name+"</a>"),r.innerHTML='<a href="#rename__file-'+e.id+'" class="link link_rename" data-file__id="'+e.id+'" data-file__name="'+e.real_name+'">Rename</a>',l.innerHTML='<a href="php/remove.php?remove_file__id='+e.id+'" class="link link_remove" data-file_id="'+e.id+'" data-real_name="'+e.real_name+'" title="Remove '+e.real_name+'">Remove</a>',1==e.type&&(s.innerHTML='<a href="#public_link__id='+e.id+'" class="link link_public" data-file__id="'+e.id+'" title="Get Public Link for '+e.real_name+'">Public Link</a>')}),runAfterJSReady()}},loggedin()?r.send(o):console.warn("please, login to see your files")}function renameLinkPrompt(e=".link_rename"){const n=document.querySelectorAll(e);null==n||0>=n.length?console.log("Cannot find rename links: "+e):n.forEach(e=>{e.addEventListener("click",(function(n){n.preventDefault();var t=window.prompt("New name:",e.dataset.file__name);if(!t||t==e.dataset.file__name)return!1;startProgress();let o=new FormData;o.append("file__rename","true"),o.append("file__id",e.dataset.file__id),o.append("file__name",t);var r=new XMLHttpRequest;r.open("POST","php/update.php",!0),r.onload=function(){if(!(this.status>=200&&this.status<400))return console.debug("We reached our target server, but it returned an error"),!1;runRefresh()},r.send(o)}))})}function handleAddFolder(e=".button_add-folder"){const n=document.querySelector(e);n&&null!=n&&null!=n?n.addEventListener("click",(function(e){let n=prompt("New Folder Name","New Folder");if(document.body.style.cursor="progress",!n||null==n||null==n||0==n.length)return console.debug("Empty new name"),void(document.body.style.cursor="default");let t=new FormData;t.append("add_folder","true"),t.append("add_folder__name",n);var o=new XMLHttpRequest;o.open("POST","php/upload.php",!0),o.onload=function(){if(!(this.status>=200&&this.status<400))return console.debug("We reached our target server, but it returned an error"),!1;{let e=JSON.parse(this.response);if(!e||null==e||null==e||0==e.length)return console.debug("Cannot get answer from server with data:"),void console.debug(t);console.debug(e),runRefresh()}},o.send(t)})):console.debug("Cannot find button: "+e)}function loggedin(){let e=getCookie("user__loggedin");return!(!e||null==e||null==e||1!=e)}function loginHandler(e="#login"){const n=document.querySelector(e);null!=n&&null!=n?n.addEventListener("submit",e=>{e.preventDefault(),document.body.style.cursor="progress",console.debug("Login Form sent via AJAX"),AJAXSubmit(n)}):console.debug("Cannot find Login form: "+e)}function unblockLogin(e){let n=document.querySelectorAll(".block_private"),t=document.querySelectorAll(".block_public");e&&((n||null!=n||null!=n)&&n.forEach(e=>{e.classList.remove("block_private")}),(t||null!=t||null!=t)&&t.forEach(e=>{e.classList.remove("block_public"),e.classList.add("block_hidden")}))}function removeLinkConfirm(e=".link_remove"){const n=document.querySelectorAll(e);null==n||0>=n.length?console.log("Cannot find remove links: "+e):n.forEach(e=>{e.addEventListener("click",(function(n){var t=window.confirm("Do you really want to remove "+e.dataset.real_name+" ?");startProgress(),t||(n.preventDefault(),endProgress())}))})}function publicLinkConfirm(e=".link_public"){const n=document.querySelectorAll(e);null==n||0>=n.length?console.log("Cannot find public links: "+e):n.forEach(e=>{e.addEventListener("click",(function(n){n.preventDefault(),startProgress();let t=new FormData;t.append("get_public_link","true"),t.append("file__id",e.dataset.file__id);var o=new XMLHttpRequest;o.open("POST","php/download.php",!0),o.onload=function(){if(!(this.status>=200&&this.status<400))return console.debug("We reached our target server, but it returned an error"),!1;var e=JSON.parse(this.response);if(!e||null==e||null==e||0==e.length)return console.debug("Cannot answer: "),void console.debug(t);alert(window.location.hostname+"/php/download.php?public_link="+e.public_link),runRefresh(),endProgress()},o.send(t)}))})}function folderLink(e=".link_folder"){const n=document.querySelectorAll(e);null==n||0>=n.length?console.log("Cannot find folder links: "+e):n.forEach(e=>{e.addEventListener("click",(function(n){n.preventDefault(),refreshTable(".files tbody",e.dataset.folder__id),startProgress()}))})}ready((function(){startProgress(),loginHandler(),refreshTable(),handleUploadForm(),unblockLogin(loggedin()),endProgress()}));
//# sourceMappingURL=script.js.map